(function(){"use strict";var t={1717:function(t,e,a){var s=a(3832),o=a.n(s),r=a(5596),i=a.n(r),n=a(1604),l=a.n(n),c=a(8228),d=a.n(c),u=a(6782),m=a.n(u),p=a(167),f=a.n(p),h=a(1362),g=a.n(h),v=a(5319),b=a.n(v),y=a(1227),w=a.n(y),_=a(685),T=a.n(_),C=a(7705),x=a.n(C),A=a(3715),I=a.n(A),S=a(9507),$=a.n(S),F=a(6210),L=a.n(F),N=a(3656),k=a.n(N),D=a(406),R=a.n(D),P=a(2916),M=a.n(P),O=a(6848),E=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"app"}},[e("router-view")],1)},q=[],j={name:"App",components:{}},z=j,H=a(1656),J=(0,H.A)(z,E,q,!1,null,null,null),B=J.exports,G=a(6178),V=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"login"}},[t._m(0),e("div",{staticClass:"login-container"},[e("div",{staticClass:"tab-header"},[e("div",{staticClass:"tab-item",class:{active:t.isLoginActive},on:{click:t.changeToLogin}},[t._v(" 登录 ")]),e("div",{staticClass:"tab-item",class:{active:!t.isLoginActive},on:{click:t.changeToRegister}},[t._v(" 患者注册 ")])]),e("div",{staticClass:"form-content"},[t.isLoginActive?e("form",{staticClass:"login-form"},[e("div",{staticClass:"form-radio"},[e("span",[t._v("您的身份是：")]),e("label",[e("input",{directives:[{name:"model",rawName:"v-model",value:t.loginForm.role,expression:"loginForm.role"}],attrs:{type:"radio",name:"role"},domProps:{value:1,checked:t._q(t.loginForm.role,1)},on:{change:function(e){return t.$set(t.loginForm,"role",1)}}}),t._v("医生 ")]),e("label",[e("input",{directives:[{name:"model",rawName:"v-model",value:t.loginForm.role,expression:"loginForm.role"}],attrs:{type:"radio",name:"role"},domProps:{value:0,checked:t._q(t.loginForm.role,0)},on:{change:function(e){return t.$set(t.loginForm,"role",0)}}}),t._v("患者 ")])]),e("div",{staticClass:"form-group"},[e("label",[t._v("账号")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.loginForm.account,expression:"loginForm.account"}],attrs:{type:"text",placeholder:"请输入账号"},domProps:{value:t.loginForm.account},on:{input:function(e){e.target.composing||t.$set(t.loginForm,"account",e.target.value)}}})]),e("div",{staticClass:"form-group"},[e("label",[t._v("密码")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.loginForm.password,expression:"loginForm.password"}],attrs:{type:"text",placeholder:"请输入密码"},domProps:{value:t.loginForm.password},on:{input:function(e){e.target.composing||t.$set(t.loginForm,"password",e.target.value)}}})]),e("button",{staticClass:"submit-btn",attrs:{type:"button"},on:{click:t.handleLogin}},[t._v("登录")])]):e("form",{staticClass:"register-form"},[e("div",{staticClass:"form-group"},[e("label",[t._v("新账号")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.registerForm.account,expression:"registerForm.account"}],attrs:{type:"text",placeholder:"请设置账号"},domProps:{value:t.registerForm.account},on:{input:function(e){e.target.composing||t.$set(t.registerForm,"account",e.target.value)}}})]),e("div",{staticClass:"form-group"},[e("label",[t._v("密码")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.registerForm.password,expression:"registerForm.password"}],attrs:{type:"text",placeholder:"请设置密码"},domProps:{value:t.registerForm.password},on:{input:function(e){e.target.composing||t.$set(t.registerForm,"password",e.target.value)}}})]),e("div",{staticClass:"form-group"},[e("label",[t._v("确认密码")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.registerForm.confirmPwd,expression:"registerForm.confirmPwd"}],attrs:{type:"text",placeholder:"请再次输入密码"},domProps:{value:t.registerForm.confirmPwd},on:{input:function(e){e.target.composing||t.$set(t.registerForm,"confirmPwd",e.target.value)}}})]),e("button",{staticClass:"submit-btn",on:{click:t.handleRegister}},[t._v("注册")])])])])])},K=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"title"},[e("h1",{staticClass:"the-title"},[t._v("医院挂号系统")])])}],Q=(a(4114),a(4373)),U={name:"TheLogin",data(){return{isLoginActive:!0,loginForm:{account:"",password:"",role:""},registerForm:{account:"",password:"",confirmPwd:""}}},methods:{async toLogin(){try{const t="http://192.168.130.45:3333/login",e={username:this.loginForm.account,password:this.loginForm.password,role:this.loginForm.role},a=await Q.A.post(t,e,{timeout:6e5});if(200===a.data.code){const t={userId:a.data.userId,role:this.loginForm.role};console.log(this.loginForm.role);const e=a.data.msg;localStorage.setItem("token",e),console.log(e),console.log(localStorage.getItem("token")),console.log("成功"),localStorage.setItem("userAuth",JSON.stringify(t));const s=1===this.loginForm.role?"/doctor":"/patient";this.$router.push(s)}}catch(t){console.error("请求失败",t)}},async toRegister(){try{const t="http://192.168.130.45:3333/patient/register",e={username:this.registerForm.account,password:this.registerForm.password,role:0},a=await Q.A.post(t,e);200===a.data.code&&(alert("注册成功，请登录"),this.isLoginActive=!0)}catch(t){console.error("请求失败",t)}},changeToLogin(){this.isLoginActive=!0},changeToRegister(){this.isLoginActive=!1},handleLogin(){this.loginForm.account&&this.loginForm.password?this.toLogin():alert("请填写完整！")},handleRegister(){this.registerForm.account&&this.registerForm.password&&this.registerForm.confirmPwd?this.registerForm.password===this.registerForm.confirmPwd?this.toRegister():alert("密码不一致！请重新填写！"):alert("请填写完整！")}}},W=U,X=(0,H.A)(W,V,K,!1,null,"26ecf91b",null),Y=X.exports,Z=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"patient"}},[e("MyHead"),e("PatientNav",{staticClass:"paNav"}),e("div",{staticClass:"route-content-wrapper"},[e("router-view")],1)],1)},tt=[],et=function(){var t=this,e=t._self._c;return e("header",{staticClass:"app-header"},[e("div",{staticClass:"header-container"},[e("div",{staticClass:"header-title"},[t._v(" 医院挂号系统 ")]),e("button",{staticClass:"logout-btn",on:{click:t.handleLogout}},[t._v(" 退出登录 ")])])])},at=[],st={name:"MyHead",methods:{handleLogout(){localStorage.removeItem("userAuth"),localStorage.removeItem("token"),this.$user.userId="",this.$router.push("/login"),alert("已成功退出登录")}}},ot=st,rt=(0,H.A)(ot,et,at,!1,null,"1f032faf",null),it=rt.exports,nt=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"pa-nav"}},[e("el-menu",{staticClass:"el-menu",attrs:{mode:"horizontal","default-active":t.currentRoute,router:""}},[e("el-menu-item",{staticClass:"el-menu-item",attrs:{index:"/patient/doctor-list"}},[t._v("医生列表")]),e("el-menu-item",{staticClass:"el-menu-item",attrs:{index:"/patient/register"}},[t._v("挂号确认")]),e("el-menu-item",{staticClass:"el-menu-item",attrs:{index:"/patient/record"}},[t._v("挂号记录")])],1)],1)},lt=[],ct={name:"PatientNav",data(){return{currentRoute:"/patient/doctor-list"}},watch:{$route:{immediate:!0,handler(t){this.currentRoute=t.path}}}},dt=ct,ut=(0,H.A)(dt,nt,lt,!1,null,"7f50b6e3",null),mt=ut.exports,pt={name:"PatientPage",components:{MyHead:it,PatientNav:mt},data(){return{}}},ft=pt,ht=(0,H.A)(ft,Z,tt,!1,null,"2fcee1fd",null),gt=ht.exports,vt=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"doc-list"}},[e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData,border:""}},[e("el-table-column",{attrs:{prop:"name",label:"医生姓名",width:"180"}}),e("el-table-column",{attrs:{prop:"gender",label:"性别",width:"180"}}),e("el-table-column",{attrs:{prop:"office",label:"科室"}}),e("el-table-column",{attrs:{prop:"position",label:"职位"}}),e("el-table-column",{attrs:{prop:"study",label:"擅长方向"}}),e("el-table-column",{scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-button",{attrs:{size:"mini"},on:{click:function(e){return t.ToRegister(a.row)}}},[t._v(" 去挂号 ")])]}}])})],1)],1)},bt=[],yt=(a(8111),a(1701),{name:"DoctorList",data(){return{tableData:[]}},created(){this.getDoctorData()},methods:{async getDoctorData(){try{const t=await Q.A.get("http://192.168.130.45:3333/patient/doctor-list",{params:{userId:this.$user.userId}});if(200===t.data.code){const e=t.data.data,a=e.map(t=>({doctorId:t.doctorId,name:t.name,gender:t.gender,office:t.office,position:t.position,study:t.study}));console.log(a),this.tableData=a}}catch(t){console.error("请求失败",t)}},ToRegister(t){this.$router.push({path:"/patient/register",query:{doctorId:t.doctorId,name:t.name,gender:t.gender,office:t.office,position:t.position,study:t.study}})}}}),wt=yt,_t=(0,H.A)(wt,vt,bt,!1,null,"3c43a087",null),Tt=_t.exports,Ct=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"card-form"}},[e("ReCard",{staticClass:"left",attrs:{doctorInfo:t.doctorInfo}}),e("div",{staticClass:"line"}),e("ReForm",{staticClass:"right",attrs:{doctorInfo:t.doctorInfo}})],1)},xt=[],At=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"outer"}},[e("div",{staticClass:"doctor-card"},[t._m(0),e("div",{staticClass:"doctor-info-wrap"},[e("div",{staticClass:"info-item"},[e("span",{staticClass:"info-label"},[t._v("姓名：")]),e("span",{staticClass:"info-content"},[t._v(t._s(t.doctorInfo.name))])]),e("div",{staticClass:"info-item"},[e("span",{staticClass:"info-label"},[t._v("性别：")]),e("span",{staticClass:"info-content"},[t._v(t._s(t.doctorInfo.gender))])]),e("div",{staticClass:"info-item"},[e("span",{staticClass:"info-label"},[t._v("科室：")]),e("span",{staticClass:"info-content"},[t._v(t._s(t.doctorInfo.office))])]),e("div",{staticClass:"info-item"},[e("span",{staticClass:"info-label"},[t._v("职位：")]),e("span",{staticClass:"info-content"},[t._v(t._s(t.doctorInfo.position))])]),e("div",{staticClass:"info-item info-expertise"},[e("span",{staticClass:"info-label"},[t._v("擅长方向：")]),e("span",{staticClass:"info-content"},[t._v(t._s(t.doctorInfo.study))])])])]),e("div",{staticClass:"register-form-container"},[e("h3",{staticClass:"form-title"},[t._v("挂号信息填写")]),e("el-form",{ref:"registerFormRef",staticClass:"form-content",attrs:{model:t.registerForm,"label-width":"80px"}},[e("el-form-item",{attrs:{label:"患者姓名"}},[e("el-input",{attrs:{placeholder:"请输入患者真实姓名",maxlength:"10"},model:{value:t.registerForm.patientName,callback:function(e){t.$set(t.registerForm,"patientName",e)},expression:"registerForm.patientName"}})],1),e("el-row",{staticClass:"btnRow"},[e("el-button",{staticClass:"btn",attrs:{type:"primary",size:"small"},on:{click:t.saveName}},[t._v("确认")])],1)],1)],1)])},It=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"card-header"},[e("h3",{staticClass:"header-text"},[t._v("医生信息")]),e("div",{staticClass:"header-divider"})])}],St={name:"ReCard",props:{doctorInfo:{type:Object,require:!0,default:()=>({docterId:"未知",name:"未知",gender:"未知",office:"未知",position:"未知",study:"未知"})}},data(){return{registerForm:{patientName:""}}},methods:{saveName(){this.$bus.$emit("getName",this.registerForm.patientName)}}},$t=St,Ft=(0,H.A)($t,At,It,!1,null,"677af574",null),Lt=Ft.exports,Nt=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"outer"}},[e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData,stripe:""}},[e("el-table-column",{attrs:{type:"index",label:"编号",width:"100"}}),e("el-table-column",{attrs:{prop:"time",label:"时段",width:"150"}}),e("el-table-column",{attrs:{prop:"type",label:"号种",width:"130"}}),e("el-table-column",{attrs:{prop:"fee",label:"费用",width:"120"}}),e("el-table-column",{attrs:{label:"操作",width:"150"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-row",[e("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.toRegis(a.row)}}},[t._v(" 挂号 ")])],1)]}}])})],1)],1)},kt=[],Dt={name:"ReForm",props:{doctorInfo:{type:Object,required:!0}},data(){return{tableData:[],patientName:"",singleRegisData:""}},methods:{async getRegisInfo(){try{const t=await Q.A.get("http://192.168.130.45:3333/patient/selectDoctorRegistration",{params:{doctorId:this.$route.query.doctorId}});if(console.log(this.$route.query.doctorId),200===t.data.code){const e=t.data.data;console.log("患者看某医生挂号时间成功！"),console.log(e);const a=e.map(t=>({time:t.time,type:t.type,fee:t.fee}));this.tableData=a}}catch(t){console.error("请求失败",t)}},async sendRegisInfo(t){try{const e={doctorId:this.doctorInfo.doctorId,doctorName:this.doctorInfo.name,name:this.patientName,userId:this.$user.userId,time:t.time,type:t.type,fee:t.fee};console.log(e);const a=await Q.A.post("http://192.168.130.45:3333/patient/post",e);200===a.data.code&&(alert("挂号成功！"),console.log("挂号成功"))}catch(e){console.error("请求失败",e)}},toRegis(t){this.sendRegisInfo(t)},getPatientName(t){this.patientName=t}},created(){this.$bus.$on("getName",this.getPatientName),this.getRegisInfo(),console.log(this.$route.query.doctorId)},beforeDestroy(){this.$bus.$off("getName")}},Rt=Dt,Pt=(0,H.A)(Rt,Nt,kt,!1,null,"28bfd2fe",null),Mt=Pt.exports,Ot={name:"CardForm",components:{ReCard:Lt,ReForm:Mt},data(){return{doctorInfo:{}}},created(){this.doctorInfo=this.$route.query}},Et=Ot,qt=(0,H.A)(Et,Ct,xt,!1,null,"45bcfd76",null),jt=qt.exports,zt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"order-record-page"},[e("h2",[t._v("我的挂号记录")]),e("el-table",{staticStyle:{width:"951px","margin-top":"20px"},attrs:{data:t.orderList,border:"",stripe:""}},[e("el-table-column",{attrs:{prop:"id",label:"订单号",align:"center",width:"180"}}),e("el-table-column",{attrs:{prop:"doctorName",label:"医生姓名",align:"center",width:"120"}}),e("el-table-column",{attrs:{prop:"registerTime",label:"挂号时段",align:"center",width:"220"}}),e("el-table-column",{attrs:{prop:"type",label:"号种",align:"center",width:"210"}}),e("el-table-column",{attrs:{prop:"status",label:"订单状态",align:"center",width:"220"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-tag",{attrs:{type:t.getStatusTagType(a.row.status)}},[t._v(" "+t._s(t.getStatusText(a.row.status))+" ")])]}}])})],1)],1)},Ht=[],Jt={name:"PaRecord",data(){return{orderList:[],isLoading:!1,statusMap:{0:"待就诊",1:"已就诊",2:"失约"},statusTagTypeMap:{0:"warning",1:"success",2:"danger"}}},created(){this.getOrderList()},methods:{async getOrderList(){this.isLoading=!0;try{const t=await Q.A.get("http://192.168.130.45:3333/patient/record",{params:{userId:this.$user.userId}});if(200===t.data.code){const e=t.data.data,a=e.map(t=>({id:t.id,doctorName:t.doctorName,registerTime:t.time,type:t.type,status:t.status}));this.orderList=a}}catch(t){this.$message.error("请求出错",t)}finally{this.isLoading=!1}},getStatusText(t){return this.statusMap[t]||"未知状态"},getStatusTagType(t){return this.statusTagTypeMap[t]||"default"}}},Bt=Jt,Gt=(0,H.A)(Bt,zt,Ht,!1,null,"4a396ea6",null),Vt=Gt.exports,Kt=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"doctor"}},[e("MyHead"),e("DocNav",{staticClass:"nav"}),e("div",{staticClass:"route-content-wrapper"},[e("router-view")],1)],1)},Qt=[],Ut=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"doc-nav"}},[e("el-menu",{staticClass:"el-menu",attrs:{mode:"horizontal","default-active":t.currentRoute,router:""}},[e("el-menu-item",{staticClass:"el-menu-item",attrs:{index:"/doctor/doc-info"}},[t._v("个人信息")]),e("el-menu-item",{staticClass:"el-menu-item",attrs:{index:"/doctor/doc-schedule"}},[t._v("排班设置")]),e("el-menu-item",{staticClass:"el-menu-item",attrs:{index:"/doctor/regis-manage"}},[t._v("挂号管理")]),e("el-menu-item",{staticClass:"el-menu-item",attrs:{index:"/doctor/regis"}},[t._v("医生注册")])],1)],1)},Wt=[],Xt={name:"DocNav",data(){return{currentRoute:"/doctor/doc-info"}},watch:{$route:{immediate:!0,handler(t){this.currentRoute=t.path}}}},Yt=Xt,Zt=(0,H.A)(Yt,Ut,Wt,!1,null,null,null),te=Zt.exports,ee={name:"DoctorPage",components:{MyHead:it,DocNav:te},data(){return{}}},ae=ee,se=(0,H.A)(ae,Kt,Qt,!1,null,null,null),oe=se.exports,re=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"app-container"}},[e("div",{staticClass:"doctor-card"},[t._m(0),e("div",{staticClass:"doctor-info-wrap"},[e("div",{staticClass:"info-item"},[e("span",{staticClass:"info-label"},[t._v("姓名：")]),e("span",{staticClass:"info-content"},[t._v(t._s(t.doctorInfo.name))])]),e("div",{staticClass:"info-item"},[e("span",{staticClass:"info-label"},[t._v("年龄：")]),e("span",{staticClass:"info-content"},[t._v(t._s(t.doctorInfo.age))])]),e("div",{staticClass:"info-item"},[e("span",{staticClass:"info-label"},[t._v("科室：")]),e("span",{staticClass:"info-content"},[t._v(t._s(t.doctorInfo.office))])]),e("div",{staticClass:"info-item"},[e("span",{staticClass:"info-label"},[t._v("职位：")]),e("span",{staticClass:"info-content"},[t._v(t._s(t.doctorInfo.position))])]),e("div",{staticClass:"info-item info-expertise"},[e("span",{staticClass:"info-label"},[t._v("擅长方向：")]),e("span",{staticClass:"info-content"},[t._v(t._s(t.doctorInfo.study))])])]),e("div",{staticClass:"card-footer-line"})])])},ie=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"card-header"},[e("h3",{staticClass:"header-text"},[t._v("医生信息")]),e("div",{staticClass:"header-divider"})])}],ne={name:"DocInfo",data(){return{doctorInfo:{}}},created(){this.getInfo()},methods:{async getInfo(){try{const t=await Q.A.get("http://192.168.130.45:3333/doctor/show",{params:{userId:this.$user.userId}});200===t.data.code&&(this.doctorInfo=t.data.data,console.log(this.doctorInfo),console.log("医生信息请求成功"))}catch(t){console.error("请求失败",t)}}}},le=ne,ce=(0,H.A)(le,re,ie,!1,null,"6472b160",null),de=ce.exports,ue=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"outer"}},[e("div",{staticClass:"schedule-form",staticStyle:{"margin-bottom":"20px",display:"flex",gap:"15px","align-items":"center"}},[e("el-select",{staticStyle:{width:"180px"},attrs:{placeholder:"选择初始时间",disabled:!t.timeOptions.length},model:{value:t.selectedStartTime,callback:function(e){t.selectedStartTime=e},expression:"selectedStartTime"}},t._l(t.timeOptions,function(a){return e("el-option",{key:a,attrs:{label:a,value:a,disabled:t.isTimeDisabled(a)}})}),1),e("el-select",{staticStyle:{width:"180px"},attrs:{placeholder:"选择结束时间",disabled:!t.selectedStartTime},model:{value:t.selectedEndTime,callback:function(e){t.selectedEndTime=e},expression:"selectedEndTime"}},t._l(t.getEndTimeOptions(),function(t){return e("el-option",{key:t,attrs:{label:t,value:t}})}),1),e("el-select",{staticStyle:{width:"120px"},attrs:{placeholder:"选择号种",disabled:!t.selectedStartTime||!t.selectedEndTime},model:{value:t.selectedTypeText,callback:function(e){t.selectedTypeText=e},expression:"selectedTypeText"}},[e("el-option",{attrs:{label:"专家号",value:"专家号",disabled:60!==t.getDuration()}}),e("el-option",{attrs:{label:"普通号",value:"普通号",disabled:30!==t.getDuration()}})],1),e("el-button",{attrs:{type:"primary",disabled:!t.selectedStartTime||!t.selectedEndTime||!t.selectedTypeText},on:{click:t.handleAddSchedule}},[t._v(" 添加 ")])],1),e("el-table",{staticStyle:{width:"100%","margin-bottom":"20px"},attrs:{data:t.sortedTableData,"row-class-name":t.tableRowClassName,"empty-text":0===t.tableData.length?"暂无排班信息，请添加":"加载中..."}},[e("el-table-column",{attrs:{type:"index",label:"编号",width:"150"}}),e("el-table-column",{attrs:{prop:"time",label:"时段",width:"200"}}),e("el-table-column",{attrs:{prop:"typeText",label:"号种",width:"200"}}),e("el-table-column",{attrs:{prop:"fee",label:"费用",width:"200"}}),e("el-table-column",{attrs:{label:"操作",width:"200"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(e){return t.handleRemoveSchedule(a.row)}}},[t._v(" 移除 ")])]}}])})],1),e("div",{staticStyle:{"text-align":"center","margin-top":"20px"}},[e("el-button",{attrs:{type:"success",size:"medium",disabled:0===t.tableData.length},on:{click:t.confirmAllSchedules}},[t._v(" 确认排版模板 ")])],1)],1)},me=[],pe=(a(7588),a(8237),a(3579),{name:"DocSchedule",data(){return{tableData:[],selectedStartTime:"",selectedEndTime:"",selectedTypeText:"",workTimeRanges:[{start:9,end:12},{start:14,end:17}],doctorId:Number(this.$user.userId)}},computed:{timeOptions(){const t=[];return this.workTimeRanges.forEach(e=>{for(let a=e.start;a<e.end;a++)t.push(`${a}:00`),t.push(`${a}:30`);t.push(`${e.end}:00`)}),t},sortedTableData(){return[...this.tableData].sort((t,e)=>{const a=this.timeToMinutes(t.startTime),s=this.timeToMinutes(e.startTime);return a-s})}},methods:{timeToMinutes(t){return t.split(":").reduce((t,e)=>60*t+Number(e),0)},getEndTimeOptions(){if(!this.selectedStartTime)return[];const t=[],e=this.timeToMinutes(this.selectedStartTime),a=[this.minutesToTime(e+30),this.minutesToTime(e+60)];return a.forEach(e=>{this.isValidEndTime(e)&&this.isAvailableTimeSlot(e)&&t.push(e)}),t},minutesToTime(t){const e=Math.floor(t/60),a=t%60;return`${e}:${a.toString().padStart(2,"0")}`},isValidEndTime(t){const[e]=t.split(":").map(Number);return e<this.workTimeRanges[1].end},isAvailableTimeSlot(t){const e=this.timeToMinutes(t);return!this.tableData.some(t=>{const a=this.timeToMinutes(t.startTime),s=this.timeToMinutes(t.endTime);return e>a&&e<s})},getDuration(){if(!this.selectedStartTime||!this.selectedEndTime)return 0;const[t,e]=this.selectedStartTime.split(":").map(Number),[a,s]=this.selectedEndTime.split(":").map(Number),o=60*t+e,r=60*a+s;return r-o},isTimeDisabled(t){const e=this.timeToMinutes(t);return this.tableData.some(t=>{const a=this.timeToMinutes(t.startTime),s=this.timeToMinutes(t.endTime);return e>=a&&e<s})},async handleAddSchedule(){if(this.isTimeDisabled(this.selectedStartTime))return void this.$message.error("该时间已被占用，请选择其他时间");const t="专家号"===this.selectedTypeText,e=t?1:0,a=t?30:50,s={time:`${this.selectedStartTime}-${this.selectedEndTime}`,type:e,typeText:this.selectedTypeText,fee:a,startTime:this.selectedStartTime,endTime:this.selectedEndTime};this.tableData.push(s),this.$message.success("已添加到排班列表"),this.selectedStartTime="",this.selectedEndTime="",this.selectedTypeText=""},handleRemoveSchedule(t){const e=this.tableData.findIndex(e=>e.time===t.time);-1!==e&&(this.tableData.splice(e,1),this.$message.success("已从排班列表移除"))},async confirmAllSchedules(){this.$confirm("确定要提交当前所有排班信息吗？提交后将保存为排版模板","确认提交",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const t={doctorId:this.doctorId,schedules:this.tableData.map(t=>({time:t.time,type:t.type,fee:t.fee}))};console.log(t);const e=await Q.A.post("http://192.168.130.45:3333/doctor/schedule",t);200===e.data.code?alert("排版模板提交成功！"):(alert("提交失败："),console.error("提交失败",e.data.msg))}catch(t){console.error("提交排版模板失败",t),this.$message.error("网络错误，提交失败请重试")}}).catch(()=>{this.$message.info("已取消提交")})},tableRowClassName({row:t}){return 1===t.type?"expert-row":"normal-row"}}}),fe=pe,he=(0,H.A)(fe,ue,me,!1,null,"5691c064",null),ge=he.exports,ve=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"doc-regismanage"}},[e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData}},[e("el-table-column",{attrs:{prop:"name",label:"患者姓名",width:"220"}}),e("el-table-column",{attrs:{prop:"time",label:"挂号时段",width:"220"}}),e("el-table-column",{attrs:{prop:"type",label:"号种",width:"220"}}),e("el-table-column",{attrs:{prop:"lost",label:"患者失约次数",width:"220"}}),e("el-table-column",{attrs:{label:"当前状态"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-dropdown",{attrs:{"popper-append-to-body":""},on:{command:e=>t.handleStatusChange(e,a.row)}},[e("el-button",{attrs:{type:a.row.status.type}},[t._v(" "+t._s(a.row.status.text)+" "),e("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},t._l(t.allStatuses,function(s){return e("el-dropdown-item",{key:s.value,attrs:{command:s.value,disabled:s.value===a.row.status.value}},[t._v(" "+t._s(s.text)+" ")])}),1)],1)]}}])})],1)],1)},be=[],ye=(a(116),{name:"RegisManage",data(){return{tableData:[],allStatuses:[{value:"pending",text:"待就诊",type:"primary"},{value:"completed",text:"已完成",type:"success"},{value:"lost",text:"失约",type:"danger"}],statusMap:{0:{value:"pending",text:"待就诊",type:"primary"},1:{value:"completed",text:"已完成",type:"success"},2:{value:"lost",text:"失约",type:"danger"}},typeMap:{0:"普通号",1:"专家号"}}},async created(){await this.fetchPatientInfo();for(let t=0;t<this.tableData.length;t++){const e=this.tableData[t],a=await this.getLostTimes(e.patientId);this.$set(this.tableData[t],"lost",a)}},methods:{async fetchPatientInfo(){try{const t=await Q.A.get("http://192.168.130.45:3333/doctor/regis-message",{params:{userId:this.$user.userId}});if(console.log(this.$user.userId),200===t.data.code){const e=t.data.data;console.log(e),this.tableData=e.map(t=>({...t,status:this.statusMap[t.currentStatus]})),console.log(this.tableData),console.log("获取医生看见的挂号信息成功！")}}catch(t){console.error("获取患者信息失败",t),this.$message.error("加载失败，请重试")}},async getLostTimes(t){try{const e=await Q.A.get("http://192.168.130.45:3333/doctor/selectMissNum",{params:{patientId:t}});return 200===e.data.code?(console.log("获取失约次数成功！"),e.data.data):0}catch(e){return console.error(`获取患者${t}失约次数错误`,e),0}},async sendNewStatus(t){try{const e=await Q.A.post("http://192.168.130.45:3333/doctor/updateStatus",t);200===e.data.code&&(alert("状态更改成功"),console.log("修改患者状态成功！"))}catch(e){console.error("发送失败",e)}},handleStatusChange(t,e){const a=this.allStatuses.find(e=>e.value===t);if(a){e.status=a;const s=Object.keys(this.statusMap).find(e=>this.statusMap[e].value===t),o={userId:this.$user.userId,patientId:e.patientId,newStatus:Number(s),id:e.id};console.log(o),this.sendNewStatus(o)}}}}),we=ye,_e=(0,H.A)(we,ve,be,!1,null,null,null),Te=_e.exports,Ce=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"doc-regis"}},[e("h1",{staticClass:"title"},[t._v("新医生注册")]),e("el-form",{attrs:{"label-position":t.labelPosition,"label-width":"80px",model:t.formLabelAlign}},[e("el-form-item",{staticClass:"item",staticStyle:{"white-space":"nowrap"},attrs:{label:"新医生账号:"}},[e("el-input",{model:{value:t.formLabelAlign.account,callback:function(e){t.$set(t.formLabelAlign,"account",e)},expression:"formLabelAlign.account"}})],1),e("el-form-item",{staticClass:"item",staticStyle:{"white-space":"nowrap"},attrs:{label:"新医生密码:"}},[e("el-input",{model:{value:t.formLabelAlign.password,callback:function(e){t.$set(t.formLabelAlign,"password",e)},expression:"formLabelAlign.password"}})],1),e("el-form-item",{staticClass:"item",attrs:{label:"医生姓名:"}},[e("el-input",{model:{value:t.formLabelAlign.name,callback:function(e){t.$set(t.formLabelAlign,"name",e)},expression:"formLabelAlign.name"}})],1),e("el-form-item",{staticClass:"item",attrs:{label:"性别:"}},[e("el-input",{model:{value:t.formLabelAlign.gender,callback:function(e){t.$set(t.formLabelAlign,"gender",e)},expression:"formLabelAlign.gender"}})],1),e("el-form-item",{staticClass:"item",attrs:{label:"年龄:"}},[e("el-input",{model:{value:t.formLabelAlign.age,callback:function(e){t.$set(t.formLabelAlign,"age",t._n(e))},expression:"formLabelAlign.age"}})],1),e("el-form-item",{staticClass:"item",attrs:{label:"科室:"}},[e("el-input",{model:{value:t.formLabelAlign.office,callback:function(e){t.$set(t.formLabelAlign,"office",e)},expression:"formLabelAlign.office"}})],1),e("el-form-item",{staticClass:"item",attrs:{label:"职位:"}},[e("el-input",{model:{value:t.formLabelAlign.position,callback:function(e){t.$set(t.formLabelAlign,"position",e)},expression:"formLabelAlign.position"}})],1),e("el-form-item",{staticClass:"item",attrs:{label:"擅长方向:"}},[e("el-input",{model:{value:t.formLabelAlign.study,callback:function(e){t.$set(t.formLabelAlign,"study",e)},expression:"formLabelAlign.study"}})],1),e("el-row",[e("el-button",{staticClass:"btn",attrs:{type:"primary"},on:{click:t.submitGegis}},[t._v("注册")])],1)],1)],1)},xe=[],Ae={name:"DocRegis",data(){return{labelPosition:"right",formLabelAlign:{account:"",password:"",name:"",gender:"",office:"",position:"",study:"",age:""}}},methods:{async sendRegis(){try{const t=await Q.A.post("http://192.168.130.45:3333/doctor/register",this.formLabelAlign);if(200===t.data.code)return alert("注册成功"),void console.log("医生注册成功！");alert("注册失败"),console.log(t.data.msg)}catch(t){console.error(t)}},submitGegis(){this.sendRegis()}}},Ie=Ae,Se=(0,H.A)(Ie,Ce,xe,!1,null,"497b39c4",null),$e=Se.exports;const Fe=new G.Ay({routes:[{path:"/",redirect:"/login"},{path:"/login",component:Y},{path:"/patient",component:gt,redirect:"/patient/doctor-list",meta:{isAuth:!0,requireRole:0},children:[{path:"doctor-list",component:Tt},{path:"register",component:jt},{path:"record",component:Vt}]},{path:"/doctor",component:oe,redirect:"/doctor/doc-info",meta:{isAuth:!0,requireRole:1},children:[{path:"doc-info",component:de},{path:"doc-schedule",component:ge},{path:"regis-manage",component:Te},{path:"regis",component:$e}]}]});Fe.beforeEach((t,e,a)=>{const s=localStorage.getItem("token"),o=JSON.parse(localStorage.getItem("userAuth")||"{}"),r=o.role,i=t.meta.requireRole,n=t.meta.isAuth;if("/"===t.path||"/login"===t.path)return a();if(n){if(!s)return a("/");if(Number(i)!==Number(r))return alert("无权限访问该页面"),a(!1);a()}else a()});var Le=Fe,Ne=a(3518);O["default"].use(Ne.Ay);var ke=new Ne.Ay.Store({});O["default"].use(M()),O["default"].use(R()),O["default"].use(k()),O["default"].use(L()),O["default"].use($()),O["default"].use(I()),O["default"].use(x()),O["default"].use(T()),O["default"].use(w()),O["default"].use(b()),O["default"].use(g()),O["default"].use(f()),O["default"].use(m()),O["default"].use(d()),O["default"].use(l()),O["default"].config.productionTip=!1,O["default"].use(G.Ay),O["default"].prototype.$user={userId:""};const De=localStorage.getItem("userAuth");De&&(O["default"].prototype.$user.userId=JSON.parse(De).userId),O["default"].prototype.$message=i(),O["default"].prototype.$confirm=o().confirm,new O["default"]({render:t=>t(B),router:Le,store:ke,beforeCreate(){O["default"].prototype.$bus=this}}).$mount("#app")}},e={};function a(s){var o=e[s];if(void 0!==o)return o.exports;var r=e[s]={exports:{}};return t[s].call(r.exports,r,r.exports,a),r.exports}a.m=t,function(){var t=[];a.O=function(e,s,o,r){if(!s){var i=1/0;for(d=0;d<t.length;d++){s=t[d][0],o=t[d][1],r=t[d][2];for(var n=!0,l=0;l<s.length;l++)(!1&r||i>=r)&&Object.keys(a.O).every(function(t){return a.O[t](s[l])})?s.splice(l--,1):(n=!1,r<i&&(i=r));if(n){t.splice(d--,1);var c=o();void 0!==c&&(e=c)}}return e}r=r||0;for(var d=t.length;d>0&&t[d-1][2]>r;d--)t[d]=t[d-1];t[d]=[s,o,r]}}(),function(){a.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(e,{a:e}),e}}(),function(){a.d=function(t,e){for(var s in e)a.o(e,s)&&!a.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){a.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){var t={524:0};a.O.j=function(e){return 0===t[e]};var e=function(e,s){var o,r,i=s[0],n=s[1],l=s[2],c=0;if(i.some(function(e){return 0!==t[e]})){for(o in n)a.o(n,o)&&(a.m[o]=n[o]);if(l)var d=l(a)}for(e&&e(s);c<i.length;c++)r=i[c],a.o(t,r)&&t[r]&&t[r][0](),t[r]=0;return a.O(d)},s=self["webpackChunkvue_hospitalgis"]=self["webpackChunkvue_hospitalgis"]||[];s.forEach(e.bind(null,0)),s.push=e.bind(null,s.push.bind(s))}();var s=a.O(void 0,[504],function(){return a(1717)});s=a.O(s)})();
//# sourceMappingURL=app.c9e423d6.js.map